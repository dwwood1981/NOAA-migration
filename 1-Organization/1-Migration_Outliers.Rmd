---
title: "Migration Outliers"
author: "Robert Dinterman"
date: '`r Sys.Date()`'
output:
  md_document:
    variant: markdown_github
---

```{r, include=FALSE}
library(knitr)
opts_knit$set(root.dir = normalizePath(".."))
read_chunk("1-Migration_Outliers.R")
```

```{r global_options, include=FALSE}
knitr::opts_chunk$set(echo=FALSE, warning=FALSE, message=FALSE, dev='png')
```

```{r Start, include=FALSE}
<<Start>>
```

# Detecting Outliers for Net Migration
The IRS data currently spans across `r head(unique(netmig$year), 1)` to `r tail(unique(netmig$year), 1)` for a total of `r nrow(netmig)` observations. There were substantial changes in data formatting and collecting across this time. As such, there are likely some data problems like clerical errors in reporting values or misclassifications in FIPS codes, etc. This is meant to be a quick and dirty way of detecting outliers in the data.

The process for detecting an outlier used here is to group the in-migration data for each county across the years (on average `r length(unique(netmig$year))` years for each) and calculate the following:

$$ | X_i - median(X_{-i}) | > 7*sd(X_{-i}) $$

Values for which the above is true are flagged as potential outliers as this indicates the observation is approximately a seven sigma event (p-value of approximately `r format(2*pnorm(-7), digits = 2)`) and in expectation we should see one in `r format(1/(nrow(netmig)*2*pnorm(-7)), digits = 2)` migration datasets if each county follows an independent normal distribution. This is only meant as a quick and dirty way of detecting outliers, but there are a total of `r length(unique(flagged$fips))` flagged FIPS-year combinations:

```{r display}
<<Display>>
```

The column `flag_factor` is the flagged in-migration value for the county-year divided by the mean of in-migration for that county. The higher the value, the more unlikely the event.